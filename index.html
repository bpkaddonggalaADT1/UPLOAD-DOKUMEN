<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Dokumen Persediaan 2025</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media (max-width: 640px) {
      table { display: none; }
      .card-list { display: block; }
    }
    @media (min-width: 641px) {
      .card-list { display: none; }
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

<!-- ================= HEADER ================= -->
<header class="bg-blue-700 text-white w-full py-5 shadow-lg flex flex-col sm:flex-row items-center justify-between px-4 sm:px-8">
  <div class="flex items-center gap-3">
    <img
      src="https://upload.wikimedia.org/wikipedia/commons/e/e5/Lambang_Kabupaten_Donggala_%282015-sekarang%29.png"
      class="h-12 sm:h-14"
      alt="Logo Donggala"
    >
    <div>
      <h1 class="text-lg sm:text-2xl font-bold">Pemerintah Kabupaten Donggala</h1>
      <p class="text-sm opacity-90">Badan Pengelolaan Keuangan & Aset Daerah</p>
    </div>
  </div>

  <p class="text-xs sm:text-sm italic mt-2 sm:mt-0">
    Sistem Upload Dokumen Persediaan 2025
  </p>
</header>

<!-- ================= MAIN ================= -->
<main class="flex-grow w-full max-w-6xl mx-auto mt-6 bg-white rounded-lg shadow p-4 sm:p-6">

  <p id="infoJumlah" class="mb-1 text-sm font-medium text-gray-700"></p>
  <p id="totalSaldo" class="mb-4 text-sm font-semibold text-gray-900"></p>

  <input
    type="text"
    id="searchBox"
    placeholder="Cari Nama OPD..."
    class="border rounded p-2 text-sm w-full sm:w-64 mb-4"
    oninput="applyFilters()"
  />

  <!-- ===== TABEL ===== -->
  <table class="w-full border border-gray-300 text-sm">
    <thead class="bg-gray-200">
      <tr>
        <th class="border p-2">Nama OPD</th>
        <th class="border p-2">Saldo Awal 2025</th>
        <th class="border p-2">Dokumen</th>
      </tr>
    </thead>
    <tbody id="tabelData"></tbody>
  </table>

  <!-- ===== MOBILE CARD ===== -->
  <div id="cardList" class="card-list space-y-4"></div>

  <!-- PAGINATION -->
  <div class="flex justify-center gap-2 mt-4">
    <button onclick="prevPage()" class="px-3 py-1 bg-gray-200 rounded">Prev</button>
    <span id="pageInfo" class="text-sm"></span>
    <button onclick="nextPage()" class="px-3 py-1 bg-gray-200 rounded">Next</button>
  </div>

</main>

<!-- ================= FOOTER ================= -->
<footer class="bg-blue-800 text-white text-center py-3 text-xs mt-6">
  Â© <span id="year"></span> BIDANG ASET DAERAH (BPKAD) KABUPATEN DONGGALA
</footer>

<script>
const WEB_APP_URL =
  "https://script.google.com/macros/s/AKfycbzv8xY7kK4OpSAagGJI2Knq5efyBzQbBrhK0fE9Laj5l7BCj3owTqRRTBIbo-vrvIhR/exec";

let allData = [];
let filteredData = [];
let currentPage = 1;
const rowsPerPage = 15;

document.getElementById("year").textContent = new Date().getFullYear();

function formatRupiah(angka) {
  const num = parseFloat(String(angka).replace(/[^0-9.-]/g,""));
  if (isNaN(num)) return "-";
  return new Intl.NumberFormat("id-ID", {
    style: "currency",
    currency: "IDR"
  }).format(num);
}

async function loadData() {
  const res = await fetch(WEB_APP_URL + "?action=getAploudData");
  allData = await res.json();
  filteredData = allData;
  renderTable();
}

function applyFilters() {
  const key = searchBox.value.toLowerCase();
  filteredData = allData.filter(d =>
    d.namaOPD.toLowerCase().includes(key)
  );
  currentPage = 1;
  renderTable();
}

function renderTable() {
  const tabel = document.getElementById("tabelData");
  const cardList = document.getElementById("cardList");
  tabel.innerHTML = "";
  cardList.innerHTML = "";

  const start = (currentPage - 1) * rowsPerPage;
  const dataPage = filteredData.slice(start, start + rowsPerPage);

  dataPage.forEach(item => {
    const link =
      item.dokumen && item.dokumen.startsWith("http")
        ? `<a href="${item.dokumen}" target="_blank"
             class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700">
             Lihat Dokumen
           </a>`
        : "-";

    tabel.innerHTML += `
      <tr>
        <td class="border p-2">${item.namaOPD}</td>
        <td class="border p-2 text-right">${formatRupiah(item.saldoAwal2025)}</td>
        <td class="border p-2 text-center">${link}</td>
      </tr>
    `;

    cardList.innerHTML += `
      <div class="border rounded p-3 shadow">
        <p class="font-semibold">${item.namaOPD}</p>
        <p>Saldo: ${formatRupiah(item.saldoAwal2025)}</p>
        <div class="mt-2">${link}</div>
      </div>
    `;
  });

  const totalPages = Math.ceil(filteredData.length / rowsPerPage);
  document.getElementById("pageInfo").innerText =
    `Halaman ${currentPage} dari ${totalPages}`;
}

function prevPage() {
  if (currentPage > 1) currentPage--;
  renderTable();
}

function nextPage() {
  if (currentPage < Math.ceil(filteredData.length / rowsPerPage))
    currentPage++;
  renderTable();
}

loadData();
</script>

</body>
</html>
